<?php

use Nfse\Dto\Nfse\NfseData;
use Nfse\Xml\NfseXmlParser;

it('parses real world xml 1', function () {
    $xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><NFSe versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infNFSe Id=\"NFS15042082252190743000175000000000000223113059264808\"><xLocEmi>Marabá</xLocEmi><xLocPrestacao>Belém</xLocPrestacao><nNFSe>2</nNFSe><cLocIncid>1504208</cLocIncid><xLocIncid>Marabá</xLocIncid><xTribNac>Análise e desenvolvimento de sistemas.</xTribNac><xTribMun>Análise e desenvolvimento de sistemas</xTribMun><verAplic>EmissorWeb_1.1.0.1</verAplic><ambGer>2</ambGer><tpEmis>1</tpEmis><procEmi>2</procEmi><cStat>100</cStat><dhProc>2023-11-01T12:04:39-03:00</dhProc><nDFSe>21164</nDFSe><emit><CNPJ>52190743000175</CNPJ><xNome>52.190.743 ATILA DENIS CARDOSO DA SILVA</xNome><enderNac><xLgr>SOL POENTE</xLgr><nro>1725</nro><xBairro>CIDADE NOVA</xBairro><cMun>1504208</cMun><UF>PA</UF><CEP>68501670</CEP></enderNac></emit><valores><vTotalRet>0.00</vTotalRet><vLiq>2200.00</vLiq></valores><DPS versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infDPS Id=\"DPS150420825219074300017500900000000000000002\"><tpAmb>1</tpAmb><dhEmi>2023-11-01T12:04:39-03:00</dhEmi><verAplic>EmissorWeb_1.1.0.4</verAplic><serie>900</serie><nDPS>2</nDPS><dCompet>2023-10-31</dCompet><tpEmit>1</tpEmit><cLocEmi>1504208</cLocEmi><prest><CNPJ>52190743000175</CNPJ><IM>817445</IM><fone>9189242304</fone><email>ATILA.DANVI@OUTLOOK.COM</email><regTrib><opSimpNac>2</opSimpNac><regEspTrib>0</regEspTrib></regTrib></prest><toma><CNPJ>03279735000194</CNPJ><xNome>MAIA PRODUCAO DE SOFTWARES LTDA</xNome><end><endNac><cMun>1501402</cMun><CEP>66095055</CEP></endNac><xLgr>BARAO DO TRIUNFO</xLgr><nro>3540</nro><xCpl>SALA  813</xCpl><xBairro>MARCO</xBairro></end></toma><serv><locPrest><cLocPrestacao>1501402</cLocPrestacao></locPrest><cServ><cTribNac>010101</cTribNac><cTribMun>001</cTribMun><xDescServ>Serviços prestados de 22 de setembro a 31 outubro de 2023</xDescServ></cServ></serv><valores><vServPrest><vServ>2200.00</vServ></vServPrest><trib><tribMun><tribISSQN>1</tribISSQN><tpRetISSQN>1</tpRetISSQN></tribMun><totTrib><indTotTrib>0</indTotTrib></totTrib></trib></valores></infDPS></DPS></infNFSe><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#NFS15042082252190743000175000000000000223113059264808\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>T0h1oIE7dS/DwXoFj2NpuVtZ1CM=</DigestValue></Reference></SignedInfo><SignatureValue>lrH9dIh9zvC6j0Mr1wxjqrIyoC9GFwSHlFZQKvIdwCt/k4ZkykWCLrcLHC1gd4KMedaqc8NjwlfRxh5XxY+OdIlqPPRtzhumSQRpt892k5rNxFM+FBvNSt0eEMUtV4k4uxzN6FZNUH3LSEkogczdZs372zCqeqbhSGJTpl/KV/KUBPgZohmUpwvG/5sCN+gO5qepNKN1EF7anM7up+O1cDuek5oEJWkle71rmeQK0a8LUJ4G1ebQlGeUNTDB5lHhReGXSjS07rpqE+ZM++GWj+oyjulyR0249VRdd7derC94Uvr6qoIlsRhBla2Mp8sdsblfKQX0/cm/+fofk9iT2Q==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFSe>';

    $parser = new NfseXmlParser;
    $nfseData = $parser->parse($xml);

    expect($nfseData)->toBeInstanceOf(NfseData::class)
        ->and($nfseData->infNfse->localEmissao)->toBe('Marabá')
        ->and($nfseData->infNfse->numeroNfse)->toBe('2')
        ->and($nfseData->infNfse->emitente->cnpj)->toBe('52190743000175')
        ->and($nfseData->infNfse->valores->valorLiquido)->toBe(2200.00);
});

it('parses another world xml 2', function () {
    $xml = '<?xml version="1.0" encoding="utf-8"?><NFSe versao="1.00" xmlns="http://www.sped.fazenda.gov.br/nfse"><infNFSe Id="NFS15042082252190743000175000000000000223113059264808"><xLocEmi>Marabá</xLocEmi><xLocPrestacao>Belém</xLocPrestacao><nNFSe>2</nNFSe><cLocIncid>1504208</cLocIncid><xLocIncid>Marabá</xLocIncid><xTribNac>Análise e desenvolvimento de sistemas.</xTribNac><xTribMun>Análise e desenvolvimento de sistemas</xTribMun><verAplic>EmissorWeb_1.1.0.1</verAplic><ambGer>2</ambGer><tpEmis>1</tpEmis><procEmi>2</procEmi><cStat>100</cStat><dhProc>2023-11-01T12:04:39-03:00</dhProc><nDFSe>21164</nDFSe><emit><CNPJ>52190743000175</CNPJ><xNome>52.190.743 ATILA DENIS CARDOSO DA SILVA</xNome><enderNac><xLgr>SOL POENTE</xLgr><nro>1725</nro><xBairro>CIDADE NOVA</xBairro><cMun>1504208</cMun><UF>PA</UF><CEP>68501670</CEP></enderNac></emit><valores><vTotalRet>0.00</vTotalRet><vLiq>2200.00</vLiq></valores><DPS versao="1.00" xmlns="http://www.sped.fazenda.gov.br/nfse"><infDPS Id="DPS150420825219074300017500900000000000000002">';

    $parser = new NfseXmlParser;
    $nfseData = $parser->parse($xml);

    expect($nfseData)->toBeInstanceOf(NfseData::class)
        ->and($nfseData->infNfse->localEmissao)->toBe('Marabá')
        ->and($nfseData->infNfse->numeroNfse)->toBe('2')
        ->and($nfseData->infNfse->emitente->cnpj)->toBe('52190743000175')
        ->and($nfseData->infNfse->valores->valorLiquido)->toBe(2200.00);
});

it('parses another world xml 3', function () {
    $xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><evento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infEvento Id=\"EVT23044002257302627000114000000000000524107932661061101101001\"><verAplic>EmissorWeb_1.3.0.0</verAplic><ambGer>2</ambGer><nSeqEvento>0</nSeqEvento><dhProc>2024-11-20T10:53:37-03:00</dhProc><nDFe>0</nDFe><pedRegEvento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infPedReg Id=\"PRE23044002257302627000114000000000000524107932661061101101001\"><tpAmb>1</tpAmb><verAplic>EmissorWeb_1.3.0.0</verAplic><dhEvento>2024-11-20T10:53:37-03:00</dhEvento><CNPJAutor>57302627000114</CNPJAutor><chNFSe>23044002257302627000114000000000000524107932661061</chNFSe><nPedRegEvento>1</nPedRegEvento><e101101><xDesc>Cancelamento de NFS-e</xDesc><cMotivo>1</cMotivo><xMotivo>Teste errado em produção</xMotivo></e101101></infPedReg></pedRegEvento></infEvento><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#EVT23044002257302627000114000000000000524107932661061101101001\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>7craBXlmQJE0cQ5iKK6tlsTEim8=</DigestValue></Reference></SignedInfo><SignatureValue>PXJkmnbFtYXqhgoDxwTtjM0YMh4GLZhrIzuM+C58KD86mb6+GSL2x7orubBl+j6CP5PmmcfsJYA/rU8aaCt6F7TdV4tZS3K8Js7tEky4LJ3iHzejHZQxrGTBGj6lmC1rXuYVyJlMk6VKXsquha3jbj0/VmUShygjhhn8Azou+zNlfzSh4xMm9WVzxB6E+eVO83BZAr+4E6QBTPzqmwnUce9QLefMElx4+FHk1WEBqB3a8iCFmSNvu8jFdK1Y+cwYA7bvjNlSUdwd35eShGYtPLs0ANA9DZWyHDXQzcgS25dKG5VwLG10K6mfz5z9l+vOjH8qpxWbSRWwE1DC+venUg==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></evento>';

    $parser = new NfseXmlParser;
    $nfseData = $parser->parse($xml);

    expect($nfseData)->toBeInstanceOf(NfseData::class)
        ->and($nfseData->infEvento)->toBeInstanceOf(\Nfse\Dto\Nfse\InfEventoData::class)
        ->and($nfseData->infEvento->versaoAplicativo)->toBe('EmissorWeb_1.3.0.0')
        ->and($nfseData->infEvento->ambiente)->toBe(2)
        ->and($nfseData->infEvento->pedRegEvento->infPedReg->e101101->descricao)->toBe('Cancelamento de NFS-e');
});

it('parses another world xml 4', function () {
    $xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><evento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infEvento Id=\"EVT23044002257302627000114000000000000824119435138306101101001\"><verAplic>EmissorWeb_1.3.0.0</verAplic><ambGer>2</ambGer><nSeqEvento>0</nSeqEvento><dhProc>2024-11-20T10:53:09-03:00</dhProc><nDFe>0</nDFe><pedRegEvento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infPedReg Id=\"PRE23044002257302627000114000000000000824119435138306101101001\"><tpAmb>1</tpAmb><verAplic>EmissorWeb_1.3.0.0</verAplic><dhEvento>2024-11-20T10:53:09-03:00</dhEvento><CNPJAutor>57302627000114</CNPJAutor><chNFSe>23044002257302627000114000000000000824119435138306</chNFSe><nPedRegEvento>1</nPedRegEvento><e101101><xDesc>Cancelamento de NFS-e</xDesc><cMotivo>1</cMotivo><xMotivo>Teste errado em produção</xMotivo></e101101></infPedReg></pedRegEvento></infEvento><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#EVT23044002257302627000114000000000000824119435138306101101001\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>OLQF1hITTR96IUk+OLrpD662S5Y=</DigestValue></Reference></SignedInfo><SignatureValue>nnfL/UjTcutexqp5mYqvG0PoLPUJ4n7oAaD0p/2Y24O43wcrYCyqUULZETI3W29h1/ljBZ+PhKteGsvKg3Jge8liBOQlEq2xtmhzzfvlYyR1Ia6oVZ7HIQoH2i7GJenzcYAFqcJY2WWzjjC7ruFJwgo2RYfYQe6QyuZBdC1Z3XFfra3F8WIGTlbO8V38bkJnHmvhGZywPomhhW+EFyttl5VWfEaOlONuEBpDJl2Uxib8wpyRQ8f9I62rr9MLqodLKOCFUTESvHzb1WS1TIRSKO0R8YGAdRK7RkoPGzYmQcgWkvlrzeWoPRO00w2CXrgFJk8Nug/3N9fks4zjh1Ti9A==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIIcDCCBligAwIBAgINAL+C2t3533h3cvRkXDANBgkqhkiG9w0BAQsFADCBjDELMAkGA1UEBhMCQlIxEzARBgNVBAoMCklDUC1CcmFzaWwxNTAzBgNVBAsMLEF1dG9yaWRhZGUgQ2VydGlmaWNhZG9yYSBSYWl6IEJyYXNpbGVpcmEgdjEwMTEwLwYDVQQDDChBdXRvcmlkYWRlIENlcnRpZmljYWRvcmEgZG8gU0VSUFJPIFNTTHYxMB4XDTI0MDQzMDE0MDM1MloXDTI1MDQzMDE0MDM1MlowgcoxCzAJBgNVBAYTAkJSMQswCQYDVQQIDAJERjERMA8GA1UEBwwIQlJBU0lMSUExOTA3BgNVBAoMMFNFUlZJQ08gRkVERVJBTCBERSBQUk9DRVNTQU1FTlRPIERFIERBRE9TIFNFUlBSTzEXMBUGA1UEBRMOMzM2ODMxMTEwMDAxMDcxGDAWBgNVBAMMD3d3dy5uZnNlLmdvdi5icjEYMBYGA1UEDxMPQnVzaW5lc3MgRW50aXR5MRMwEQYLKwYBBAGCNzwCAQMTAkJSMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0AIH/mPRdtQg7XzOyioFy0jdrJ4JMQTGU9g7c+aeymhCEY4eh4Vv17hmgVjImiLRuGSiUFWy90Ju/zQBUFwn8kTELyv5ysCeGFhM35ekn/uQiO6syIsYTFPZgMGylM8q5Ambze0GAp7ifGyl2J2JWVkknGGfDuPx2ke8MkJzxxvEx8AqxJnYCg7+9ufBxuIdHZo/i1YxGbUp1miaHASD6x692WDSu2Bc4MAzU4zn/4diYlpyp9g13woxYdtPcAbfS2qrz9XYSBh45pn+ooEBXNBrfyN0j0O5kheaaBFIfhd/m7m/SozVYWICWR3S/q0SdWBGDdHjDgf1oLBNvjQiBwIDAQABo4IDjzCCA4swHwYDVR0jBBgwFoAUrRZPS/EMvsKKooUY1w1GJZMi480wgYgGA1UdHwSBgDB+MDygOqA4hjZodHRwOi8vcmVwb3NpdG9yaW8uc2VycHJvLmdvdi5ici9sY3IvYWNzZXJwcm9zc2x2MS5jcmwwPqA8oDqGOGh0dHA6Ly9jZXJ0aWZpY2Fkb3MyLnNlcnByby5nb3YuYnIvbGNyL2Fjc2VycHJvc3NsdjEuY3JsMIGHBggrBgEFBQcBAQR7MHkwQgYIKwYBBQUHMAKGNmh0dHA6Ly9yZXBvc2l0b3Jpby5zZXJwcm8uZ292LmJyL2NhZGVpYXMvc2VycHJvc3NsLnA3YjAzBggrBgEFBQcwAYYnaHR0cDovL29jc3Auc2VycHJvLmdvdi5ici9hY3NlcnByb3NzbHYxMD4GA1UdEQQ3MDWCD3d3dy5uZnNlLmdvdi5icoIRc2VmaW4ubmZzZS5nb3YuYnKCD2Fkbi5uZnNlLmdvdi5icjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMGMGA1UdIARcMFowCAYGZ4EMAQICME4GBmBMAQIBaTBEMEIGCCsGAQUFBwIBFjZodHRwOi8vcmVwb3NpdG9yaW8uc2VycHJvLmdvdi5ici9kb2NzL2RwY3NlcnByb3NzbC5wZGYwggF9BgorBgEEAdZ5AgQCBIIBbQSCAWkBZwB1AE51oydcmhDDOFts1N8/Uusd8OCOG41pwLH6ZLFimjnfAAABjy9R24EAAAQDAEYwRAIgfTqFA1rBCS1coFGPYOO5fw+vpq3NwEb0+/TrlxOYrLMCIETZkhSrGKakgfQ46CnmaN7JV/HbDFAw0qAFEEFZYZEfAHYAzxFW7tUufK/zh1vZaS6b6RpxZ0qwF+ysAdJbd87MOwgAAAGPL1HjIAAABAMARzBFAiBPNfFvqPxtEgDvGilqm1ZXb7kw+XVMslCEsmAcol9SZgIhAKc1LJH0J1CvcUec8BYNeF5LScmhvutVKCRNyCAqsP9NAHYAKOKBOP2DIUXpqdaqdTdtg3eohRKzwH9yQUgh3L3pjGYAAAGPL1HzrQAABAMARzBFAiBZnxxEIAj4vSA23huSRk6BAVT317qcAL/4WO/wtG0MkgIhAJilRqI3WSj0vRYoQUzX43rPMJayveOK/KVvjJ0NR6NHMA0GCSqGSIb3DQEBCwUAA4ICAQDbWXqU81WDSo5ZFZmak5yfdhkSFGRpnwMYWB1D6kIMIBLV9h9ztovhYhRHENZJ/XE9s/4dzyXSe3fPFrgazo5zHulQvV8QL/0zLvqOAFKFZPugXnr7pS++/jR9Vqlt7qA3jN3YY5TizLtGnCgHxNhG7CmLJQ3Y10PEdBLOG8xaifhojT18R3jRI/CQYsRzf5SCxTZp76zA3Py1ifnq4uxVm/LtgJO33bUZ+RgXlCwORP3EnZs1k0Yvz/LaGxWntmMNv+y+7T78wb8NPd4/3bHvGcfh84lje1Fz7OkOyeKUsU8SA3wnYRS/hVrjnv02tU3szPB9oJRj7bMhjLKbdWcplnKQgwA8DPdOFARCUptq1Y2vwqlqRVHqTKDY4TyXjyVzyY090Vyax8Yr/D+Rl2aFfoFxFqGkrr0KlGhN/dFTWKeQ8brJVHDITToprGG7PESpmPT6s8BC7GD10MU4sV74sFaoweXgFE2+Tvqt3oMynlBZpvXjo5bFdA/Tm8oPG7gmZFXtGZnjyeIHuTQR+xflw5WF2SfXLhdD+B04iWWjP9lhT4dyES1RTFyEotUC51mB8b5j42+5xLaSelYbljOmo0rs7KXS+n1ej889etS+QgbHezOduzIAtrNxcHtsoiCuRLyVE0FoNJ1UgQRi3Kkw1goOUtxgixjlAAeONEqafA==</X509Certificate></X509Data></KeyInfo></Signature></evento>';
    $parser = new NfseXmlParser;
    $nfseData = $parser->parse($xml);

    expect($nfseData)->toBeInstanceOf(NfseData::class)
        ->and($nfseData->infEvento)->toBeInstanceOf(\Nfse\Dto\Nfse\InfEventoData::class)
        ->and($nfseData->infEvento->versaoAplicativo)->toBe('EmissorWeb_1.3.0.0')
        ->and($nfseData->infEvento->ambiente)->toBe(2)
        ->and($nfseData->infEvento->pedRegEvento->infPedReg->e101101->descricao)->toBe('Cancelamento de NFS-e');
});

it('parses another world xml 5', function () {
    $xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><evento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infEvento Id=\"EVT23044002257302627000114000000000000524107932661061101101001\"><verAplic>EmissorWeb_1.3.0.0</verAplic><ambGer>2</ambGer><nSeqEvento>0</nSeqEvento><dhProc>2024-11-20T10:53:37-03:00</dhProc><nDFe>0</nDFe><pedRegEvento versao=\"1.00\" xmlns=\"http://www.sped.fazenda.gov.br/nfse\"><infPedReg Id=\"PRE23044002257302627000114000000000000524107932661061101101001\"><tpAmb>1</tpAmb><verAplic>EmissorWeb_1.3.0.0</verAplic><dhEvento>2024-11-20T10:53:37-03:00</dhEvento><CNPJAutor>57302627000114</CNPJAutor><chNFSe>23044002257302627000114000000000000524107932661061</chNFSe><nPedRegEvento>1</nPedRegEvento><e101101><xDesc>Cancelamento de NFS-e</xDesc><cMotivo>1</cMotivo><xMotivo>Teste errado em produção</xMotivo></e101101></infPedReg></pedRegEvento></infEvento><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\" /><Reference URI=\"#EVT23044002257302627000114000000000000524107932661061101101001\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" /><DigestValue>7craBXlmQJE0cQ5iKK6tlsTEim8=</DigestValue></Reference></SignedInfo><SignatureValue>PXJkmnbFtYXqhgoDxwTtjM0YMh4GLZhrIzuM+C58KD86mb6+GSL2x7orubBl+j6CP5PmmcfsJYA/rU8aaCt6F7TdV4tZS3K8Js7tEky4LJ3iHzejHZQxrGTBGj6lmC1rXuYVyJlMk6VKXsquha3jbj0/VmUShygjhhn8Azou+zNlfzSh4xMm9WVzxB6E+eVO83BZAr+4E6QBTPzqmwnUce9QLefMElx4+FHk1WEBqB3a8iCFmSNvu8jFdK1Y+cwYA7bvjNlSUdwd35eShGYtPLs0ANA9DZWyHDXQzcgS25dKG5VwLG10K6mfz5z9l+vOjH8qpxWbSRWwE1DC+venUg==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></evento>';

    $parser = new NfseXmlParser;
    $nfseData = $parser->parse($xml);

    expect($nfseData)->toBeInstanceOf(NfseData::class)
        ->and($nfseData->infEvento)->toBeInstanceOf(\Nfse\Dto\Nfse\InfEventoData::class)
        ->and($nfseData->infEvento->versaoAplicativo)->toBe('EmissorWeb_1.3.0.0')
        ->and($nfseData->infEvento->ambiente)->toBe(2)
        ->and($nfseData->infEvento->pedRegEvento->infPedReg->e101101->descricao)->toBe('Cancelamento de NFS-e');
});
